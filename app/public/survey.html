<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Friend Finder</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery.js"></script>
</head>

<body>
    <div class="container">
        <form>

            <div class="row">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <strong>Your details</strong>
                        </h3>
                    </div>

                    <div class="panel-body">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="name">Name</label>
                                <input type="name" class="form-control" id="name" placeholder="Enter your name">
                            </div>
                            <div class="form-group">
                                <label form="image">Image</label>
                                <input type="link" class="form-control" id="image" placeholder="Attach a link to your photo">
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="row">
                <div class="panel panel-primary">
                    <div class="panel-heading">

                        <h3 class="panel-title">
                            <strong>Survey Questions</strong>
                        </h3>

                    </div>
                    <div class="panel-body">
                        <div class="col-md-6">
                            <div class="question1">
                                <p>1. Do you sometimes find youself thinking of solving world prolems ?.</p>
                                <select class="form-control" id="num1">
                                    <option value="1">Strongly Agree</option>
                                    <option value="2">Agree</option>
                                    <option value="3">Neutral</option>
                                    <option value="4">Disagree</option>
                                    <option value="5">Strongly Disagree</option>
                                </select>
                            </div>
                            <br>
                            <div class="question2">
                                <p>2. You like going out on trips, skiing.</p>
                                <select class="form-control" id="num2">
                                    <option value="1">Strongly Agree</option>
                                    <option value="2">Agree</option>
                                    <option value="3">Neutral</option>
                                    <option value="4">Disagree</option>
                                    <option value="5">Strongly Disagree</option>
                                </select>
                            </div>
                            <br>
                            <div class="question3">
                                <p>3. Do you easily make new friends?</p>
                                <select class="form-control" id="num3">
                                    <option value="1">Strongly Agree</option>
                                    <option value="2">Agree</option>
                                    <option value="3">Neutral</option>
                                    <option value="4">Disagree</option>
                                    <option value="5">Strongly Disagree</option>
                                </select>
                            </div>
                            <br>
                            <div class="question4">
                                <p>4. Would you describe yourself as being nerdy ?</p>
                                <select class="form-control" id="num4">
                                    <option value="1">Strongly Agree</option>
                                    <option value="2">Agree</option>
                                    <option value="3">Neutral</option>
                                    <option value="4">Disagree</option>
                                    <option value="5">Strongly Disagree</option>
                                </select>
                            </div>
                            <div class="question5">
                                <p>5. What activity would you most likely do over the weekend ?</p>
                                <select class="form-control" id="num5">
                                    <option value="1">Go Skiing</option>
                                    <option value="2">Spend time with family</option>
                                    <option value="3">Party</option>
                                    <option value="4">Read a book</option>
                                    <option value="5">Go for a run</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <button type="submit" class="btn btn-primary" id="submitBtn">Submit</button>
                </div>
            </div>

        </form>
    </div>

    <br>
    <footer class="footer">
        <nav class="navbar navbar-default ">
            <div class="container">
                <p>
                    <a href="/api/friends">API Friends Link</a> |
                    <a href="https://github.com/rutodeno/FriendFinder">GitHub Repo</a> |
                    <a href="#" id="clear">Clear Friends List</a>
                </p>
            </div>
        </nav>
    </footer>

    <script type"text/javascript">
        function getFriend() { /// getting data
            var currentURL = window.location.origin;
            $.ajax({ url: currentURL + "/api/friends", method: "GET" })
                .then(function (userData) {
                    console.log("--------------------------------------");
                    console.log("URL: " + currentURL + "/api/friends");
                    console.log("-----------------------------------------");

                    //console.log(userData);

                    matchFriend(userData);
                })
        }

        function postFriend(friends) {
            $.post("/api/friends", friends, function (data) {

                if (data) {
                    console.log("Friend data has been added");
                } else {
                    console.log("Friend data has NOT been added");
                }

                $("#name").val(""); // clear form
                $("#image").val("");
                $("#num1").val("");
                $("#num2").val("");
                $("#num3").val("");
                $("#num4").val("");
                $("#num5").val("");

            })
        }

        function clearFreindsList() {
            var currentURL = window.location.origin;
            $.ajax({ url: currentURL + "/api/clear", method: "POST" })
        }

        $("#clear").on("click", function () {
            console.log("Cleared friends list");
            clearFreindsList();
        })


        $("#submitBtn").on("click", function (event) {

            event.preventDefault();
            var friendData = {
                name: $("#name").val().trim(),
                photo: $("#image").val().trim(),

                scores: [   $("#num1").val().trim(),
                            $("#num2").val().trim(),
                            $("#num3").val().trim(),
                            $("#num4").val().trim(),
                            $("#num5").val().trim()
                        ]
            }

            postFriend(friendData) // posing data to api
            getFriend(); // getting data from api
        });

        function matchFriend(friendData) {

            var bigScoresArray = [];
            var scoreTracker = [];

            for (var j = 0; j < friendData.length; j++) {

                var intConvert = friendData[j].scores;
                var scoreArry = [];
                for (var i = 0; i < intConvert.length; i++) {

                    var x = parseInt(intConvert[i]);

                    scoreArry.push(x);
                }

                bigScoresArray.push(scoreArry);

                scoreTracker.push(bigScoresArray[j].reduce(getSum));

            }

            var differenceArray = [];

            for ( var i  = 0 ;  i < (scoreTracker.length -1) ; i++){
                
                var diff = Math.abs(scoreTracker[scoreTracker.length-1] - scoreTracker[i]);
                
                differenceArray.push(diff);

            }
            
            // person with the loweset difference is most likely one with common interest.
            var lowestNum = Math.min(...differenceArray);

            var bffIndex = differenceArray.indexOf(lowestNum); // gets index of the number

            console.log(friendData[bffIndex]);

            function getSum(total, sum) {
                return total + sum;
            }
        }
    </script>

</body>

</html>